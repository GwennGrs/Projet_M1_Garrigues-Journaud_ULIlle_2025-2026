name: Automated Hourly Data Processing and Commit

on:
  schedule:
    - cron: '0 * * * *' # Toutes les heures, à l'heure pile
  workflow_dispatch: 

jobs:
  auto_push_data:
    runs-on: ubuntu-latest
    
    # Assurez-vous d'avoir un fichier 'requirements.txt' à la racine 
    # contenant 'pandas', 'numpy', etc., si nécessaire.
    
    steps:
      - name: 1. Checkout code
        # Récupère le code de votre dépôt
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: 2. Setup Python
        # Configure l'environnement Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x' # Utilisez la version de Python souhaitée

      - name: 3. Install dependencies
        # Installe les librairies nécessaires (pandas, etc.)
        run: |
          python -m pip install --upgrade pip
          pip install pandas # Installez ici toutes vos dépendances
          # Si vous utilisez un requirements.txt : pip install -r requirements.txt

      - name: 4. Execute Python script
        # Exécute votre script Python pour générer/fusionner le nouveau JSON
        # Assurez-vous que le chemin vers votre script et la structure des dossiers sont corrects
        run: |
          # Remplacez 'votre_script.py' par le nom réel de votre fichier
          python votre_script.py 
          
      - name: 5. Configure Git
        # Configure l'utilisateur Git pour le commit
        run: |
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git config --global user.name "github-actions[bot]"

      - name: 6. Commit and Push changes
        # Ajoute le fichier modifié (le JSON fusionné) et pousse
        run: |
          # Vérifie si la commande précédente a créé des changements
          # Le '|| true' permet au workflow de ne pas échouer s'il n'y a rien à commiter
          git add .
          
          # Vérifie s'il y a des changements à commiter
          if ! git diff --cached --exit-code; then
            git commit -m "Automated data update: $(date +%Y-%m-%d %H:%M)"
            git push
            echo "Nouveaux fichiers pushés."
          else
            echo "Aucun changement détecté, pas de commit ni de push nécessaire."
          fi